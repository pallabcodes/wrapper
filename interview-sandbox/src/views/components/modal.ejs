<% 
  // Improved Modal component with Design System
  // Usage: <%- include('../components/modal', { 
  //   id: 'exampleModal',
  //   title: 'Example Modal',
  //   subtitle: 'Optional subtitle',
  //   icon: 'fas fa-info-circle',
  //   body: '<p>Modal content</p>',
  //   footer: '<button>Close</button>',
  //   size: 'md', // 'sm', 'md', 'lg', 'xl', 'full'
  //   centered: true,
  //   closable: true
  // }) %>
  
  const modalId = typeof id !== 'undefined' ? id : 'defaultModal';
  const modalTitle = typeof title !== 'undefined' ? title : 'Modal';
  const modalSubtitle = typeof subtitle !== 'undefined' ? subtitle : '';
  const modalIcon = typeof icon !== 'undefined' ? icon : '';
  const modalBody = typeof body !== 'undefined' ? body : '';
  const modalFooter = typeof footer !== 'undefined' ? footer : '';
  const modalSize = typeof size !== 'undefined' ? size : 'md';
  const modalCentered = typeof centered !== 'undefined' ? centered : true;
  const modalClosable = typeof closable !== 'undefined' ? closable : true;
  
  const sizeClasses = {
    sm: 'max-w-sm',
    md: 'max-w-md',
    lg: 'max-w-lg',
    xl: 'max-w-xl',
    '2xl': 'max-w-2xl',
    full: 'max-w-full mx-4'
  };
%>

<!-- Modal Overlay -->
<div 
  id="<%= modalId %>" 
  class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 transition-all"
  style="background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(2px);"
  onclick="if (event.target === this) closeModal('<%= modalId %>');"
>
  <div 
    class="<%= sizeClasses[modalSize] %> w-full max-h-[90vh] overflow-hidden flex flex-col rounded-design-lg shadow-design-xl transition-all transform"
    style="background-color: var(--bg-primary);"
    onclick="event.stopPropagation();"
  >
    <!-- Modal Header -->
    <div class="flex items-start justify-between p-6 border-b" style="border-color: var(--border-light);">
      <div class="flex items-start space-x-3 flex-1">
        <% if (modalIcon) { %>
          <i class="<%= modalIcon %> mt-1" style="color: var(--color-primary-600);"></i>
        <% } %>
        <div class="flex-1">
          <h3 class="text-xl font-semibold" style="color: var(--text-primary);">
            <%= modalTitle %>
          </h3>
          <% if (modalSubtitle) { %>
            <p class="mt-1 text-sm" style="color: var(--text-secondary);">
              <%= modalSubtitle %>
            </p>
          <% } %>
        </div>
      </div>
      <% if (modalClosable) { %>
        <button 
          onclick="closeModal('<%= modalId %>')" 
          class="ml-4 p-1 rounded-design-base hover:bg-secondary transition-design"
          style="color: var(--text-tertiary);"
          aria-label="Close modal"
        >
          <i class="fas fa-times text-lg"></i>
        </button>
      <% } %>
    </div>
    
    <!-- Modal Body -->
    <div class="p-6 overflow-y-auto flex-1" style="color: var(--text-primary);">
      <%- modalBody %>
    </div>
    
    <% if (modalFooter) { %>
      <!-- Modal Footer -->
      <div class="flex items-center justify-end space-x-3 p-6 border-t" style="border-color: var(--border-light);">
        <%- modalFooter %>
      </div>
    <% } %>
  </div>
</div>

<script>
  // Modal functions
  function openModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
  }
  
  function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.add('hidden');
      document.body.style.overflow = '';
    }
  }
  
  // Close modal when clicking outside
  document.getElementById('<%= modalId %>')?.addEventListener('click', function(e) {
    if (e.target === this) {
      closeModal('<%= modalId %>');
    }
  });
  
  // Close modal on Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      const modal = document.getElementById('<%= modalId %>');
      if (modal && !modal.classList.contains('hidden')) {
        closeModal('<%= modalId %>');
      }
    }
  });
  
  // Expose functions globally
  window['openModal_<%= modalId %>'] = () => openModal('<%= modalId %>');
  window['closeModal_<%= modalId %>'] = () => closeModal('<%= modalId %>');
</script>
