<% 
  const emailValue = typeof formData !== 'undefined' && formData.email ? formData.email : '';
  const nameValue = typeof formData !== 'undefined' && formData.name ? formData.name : '';
%>

<div class="min-vh-100 d-flex align-items-center justify-content-center p-4" style="background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%); padding-top: 5rem !important;">
  <div class="w-100" style="max-width: 24rem;">
    <div class="text-center mb-4">
      <h1 class="fs-3 fw-bold mb-2" style="color: var(--text-primary);">Create account</h1>
      <p class="small mb-0" style="color: var(--text-secondary);">Get started with your free account</p>
    </div>

    <div class="rounded-3 border p-4" style="background-color: var(--bg-primary); border-color: var(--border-light) !important; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
      <form action="/api/auth/register" method="POST" id="registerForm">
        <%- include('../partials/form-input', { id: 'name', name: 'name', type: 'text', label: 'Full Name', placeholder: 'John Doe', value: nameValue, required: true, autocomplete: 'name', icon: 'fas fa-user' }) %>
        <%- include('../partials/form-input', { id: 'email', name: 'email', type: 'email', label: 'Email', placeholder: 'you@example.com', value: emailValue, required: true, autocomplete: 'email', icon: 'fas fa-envelope' }) %>

        <div class="mb-3">
          <label for="password" class="form-label fw-semibold small mb-2" style="color: var(--text-primary);">Password</label>
          <div class="position-relative">
            <input type="password" id="password" name="password" placeholder="Create password" required autocomplete="new-password" minlength="8" class="form-control pe-5 ps-3 py-2" style="border-color: var(--border-medium); background-color: var(--bg-secondary); color: var(--text-primary); transition: all 0.2s ease; padding-right: 4rem !important;" onfocus="this.style.borderColor='var(--color-primary-600)';" onblur="this.style.borderColor='var(--border-medium)';">
            <div class="position-absolute top-50 end-0 translate-middle-y d-flex align-items-center px-2" style="right: 1.75rem; color: var(--text-tertiary); pointer-events: none;">
              <i class="fas fa-lock" style="font-size: 1.125rem;"></i>
            </div>
            <div id="passwordIcon" class="position-absolute top-50 end-0 translate-middle-y d-flex align-items-center opacity-0" style="right: 1rem; pointer-events: none; transition: opacity 0.3s ease;">
              <i class="fas fa-check-circle small" style="color: var(--color-success);"></i>
            </div>
          </div>
          <div id="passwordError" class="mt-1 small opacity-0" style="color: var(--color-error); transition: all 0.3s ease;"></div>
          <div id="passwordStrength" class="mt-2">
            <div class="d-flex gap-1" style="height: 0.25rem;">
              <div id="strengthBar1" class="flex-grow-1 rounded-pill" style="background-color: var(--border-light); transition: all 0.3s;"></div>
              <div id="strengthBar2" class="flex-grow-1 rounded-pill" style="background-color: var(--border-light); transition: all 0.3s;"></div>
              <div id="strengthBar3" class="flex-grow-1 rounded-pill" style="background-color: var(--border-light); transition: all 0.3s;"></div>
              <div id="strengthBar4" class="flex-grow-1 rounded-pill" style="background-color: var(--border-light); transition: all 0.3s;"></div>
            </div>
            <p id="strengthText" class="mt-1 small mb-0" style="color: var(--text-tertiary);"></p>
          </div>
        </div>

        <button type="submit" class="btn w-100 py-2 fw-semibold rounded-2 border-0 mb-3" style="background-color: var(--color-primary-600); color: var(--text-inverse); transition: all 0.2s ease;" onmouseover="if (!this.disabled) { this.style.backgroundColor='var(--color-primary-700)'; }" onmouseout="if (!this.disabled) { this.style.backgroundColor='var(--color-primary-600)'; }">
          Create Account
        </button>
      </form>

      <div class="position-relative my-3">
        <div class="position-absolute top-50 start-0 w-100"><hr class="my-0" style="border-color: var(--border-light);"></div>
        <div class="position-relative text-center"><span class="px-2 small" style="background-color: var(--bg-primary); color: var(--text-tertiary);">Or</span></div>
      </div>

      <%- include('../partials/oauth-buttons') %>

      <div class="mt-3 text-center">
        <p class="small mb-0" style="color: var(--text-secondary);">Already have an account? <a href="/auth/login" class="fw-semibold text-decoration-none" style="color: var(--color-primary-600);">Sign in</a></p>
      </div>
    </div>
  </div>
</div>

<% const scriptsContent = `<script src="/assets/form-validation.js"></script><script src="/assets/password-strength.js"></script><script>document.addEventListener('DOMContentLoaded',function(){FormValidation.setupNameValidation('name');FormValidation.setupEmailValidation('email');FormValidation.setupPasswordValidation('password',8);if(window.PasswordStrength){window.PasswordStrength.init('password');}});document.getElementById('registerForm').addEventListener('submit',async function(e){e.preventDefault();const name=document.getElementById('name').value.trim();const email=document.getElementById('email').value.trim();const password=document.getElementById('password').value;if(!name||name.length<2||!/^[a-zA-Z\\s]+$/.test(name)){FormValidation.showError(document.getElementById('name'),document.getElementById('nameError'),'Please enter your full name');document.getElementById('name').focus();return;}if(!email||!FormValidation.validateEmail(email)){FormValidation.showError(document.getElementById('email'),document.getElementById('emailError'),'Please enter a valid email');document.getElementById('email').focus();return;}if(!password||password.length<8||!/[a-zA-Z]/.test(password)||!/[0-9]/.test(password)){FormValidation.showError(document.getElementById('password'),document.getElementById('passwordError'),'Password must be at least 8 characters with letters and numbers');document.getElementById('password').focus();return;}const submitBtn=this.querySelector('button[type="submit"]');const originalContent=submitBtn.innerHTML;submitBtn.disabled=true;submitBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Creating...';const formData=new FormData(this);const data=Object.fromEntries(formData);try{const response=await fetch('/api/auth/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});const result=await response.json();if(response.ok){window.location.href='/auth/login?success=Registration successful! Please sign in.';}else{alert(result.message||'Registration failed');submitBtn.disabled=false;submitBtn.innerHTML=originalContent;}}catch(error){alert('An error occurred. Please try again.');submitBtn.disabled=false;submitBtn.innerHTML=originalContent;}});</script>`; %>
<%- include('../layouts/base', { title: 'Register - Platform', body: '', scripts: scriptsContent }) %>

