<% const emailValue = typeof formData !== 'undefined' && formData.email ? formData.email : ''; %>

<div class="min-vh-100 d-flex align-items-center justify-content-center p-4" style="background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%); padding-top: 5rem !important;">
  <div class="w-100" style="max-width: 24rem;">
    <div class="text-center mb-4">
      <h1 class="fs-3 fw-bold mb-2" style="color: var(--text-primary);">Forgot Password?</h1>
      <p class="small mb-0" style="color: var(--text-secondary);">We'll send a reset code to your email</p>
    </div>

    <div class="rounded-3 border p-4" style="background-color: var(--bg-primary); border-color: var(--border-light) !important; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
      <form action="/api/auth/forgot-password" method="POST" id="forgotPasswordForm">
        <%- include('../partials/form-input', {
          id: 'email',
          name: 'email',
          type: 'email',
          label: 'Email',
          placeholder: 'you@example.com',
          value: emailValue,
          required: true,
          autocomplete: 'email',
          icon: 'fas fa-envelope'
        }) %>

        <button type="submit" class="btn w-100 py-2 fw-semibold rounded-2 border-0 mb-3" style="background-color: var(--color-primary-600); color: var(--text-inverse); transition: all 0.2s ease;" onmouseover="if (!this.disabled) { this.style.backgroundColor='var(--color-primary-700)'; }" onmouseout="if (!this.disabled) { this.style.backgroundColor='var(--color-primary-600)'; }">
          Send Reset Code
        </button>
      </form>

      <div class="text-center">
        <a href="/auth/login" class="small fw-medium text-decoration-none d-inline-flex align-items-center gap-2" style="color: var(--color-primary-600);">
          <i class="fas fa-arrow-left"></i>
          <span>Back to sign in</span>
        </a>
      </div>
    </div>
  </div>
</div>

<% const scriptsContent = `<script src="/assets/form-validation.js"></script><script>document.addEventListener('DOMContentLoaded',function(){FormValidation.setupEmailValidation('email');});document.getElementById('forgotPasswordForm').addEventListener('submit',async function(e){e.preventDefault();const email=document.getElementById('email').value.trim();if(!email||!FormValidation.validateEmail(email)){FormValidation.showError(document.getElementById('email'),document.getElementById('emailError'),'Please enter a valid email');document.getElementById('email').focus();return;}const submitBtn=this.querySelector('button[type="submit"]');const originalContent=submitBtn.innerHTML;submitBtn.disabled=true;submitBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Sending...';const formData=new FormData(this);const data=Object.fromEntries(formData);try{const response=await fetch('/api/auth/forgot-password',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});const result=await response.json();if(response.ok){alert('Reset code sent! Check your email.');setTimeout(()=>{window.location.href='/auth/reset-password?email='+encodeURIComponent(data.email);},2000);}else{alert(result.message||'Failed to send reset code');submitBtn.disabled=false;submitBtn.innerHTML=originalContent;}}catch(error){alert('An error occurred. Please try again.');submitBtn.disabled=false;submitBtn.innerHTML=originalContent;}});</script>`; %>
<%- include('../layouts/base', { title: 'Forgot Password - Platform', body: '', scripts: scriptsContent }) %>
