<% 
  const userData = (typeof user !== 'undefined' && user !== null) ? user : {};
  const nameValue = userData.name || '';
  const emailValue = userData.email || '';
  const phoneValue = userData.phone || '';
%>

<div class="container py-5" style="padding-top: 5rem !important;">
  <div class="row justify-content-center">
    <div class="col-12" style="max-width: 32rem;">
      <div class="mb-4">
        <h1 class="fs-2 fw-bold mb-2" style="color: var(--text-primary);">Profile</h1>
        <p class="small mb-0" style="color: var(--text-secondary);">Manage your account information</p>
      </div>

      <div class="rounded-3 border p-4" style="background-color: var(--bg-primary); border-color: var(--border-light) !important; box-shadow: var(--shadow-sm);">
        <form id="profileForm">
          <%- include('../partials/form-input', { id: 'name', name: 'name', type: 'text', label: 'Full Name', placeholder: 'John Doe', value: nameValue, required: true, autocomplete: 'name', icon: 'fas fa-user' }) %>
          <%- include('../partials/form-input', { id: 'email', name: 'email', type: 'email', label: 'Email Address', placeholder: 'you@example.com', value: emailValue, required: true, autocomplete: 'email', icon: 'fas fa-envelope' }) %>
          <%- include('../partials/form-input', { id: 'phone', name: 'phone', type: 'tel', label: 'Phone Number', placeholder: '+1 (555) 000-0000', value: phoneValue, required: false, autocomplete: 'tel', icon: 'fas fa-phone' }) %>

          <div class="d-flex gap-2 mt-4">
            <button type="submit" class="btn flex-grow-1 py-2 fw-semibold rounded-2 border-0" style="background-color: var(--color-primary-600); color: var(--text-inverse); transition: all 0.2s ease;" onmouseover="if (!this.disabled) { this.style.backgroundColor='var(--color-primary-700)'; }" onmouseout="if (!this.disabled) { this.style.backgroundColor='var(--color-primary-600)'; }">
              Save Changes
            </button>
            <a href="/" class="btn py-2 px-3 rounded-2 border" style="border-color: var(--border-medium) !important; color: var(--text-secondary); background-color: var(--bg-secondary);" onmouseover="this.style.backgroundColor='var(--bg-tertiary)';" onmouseout="this.style.backgroundColor='var(--bg-secondary)';">
              Cancel
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<% const scriptsContent = `<script>document.addEventListener('DOMContentLoaded',function(){const token=localStorage.getItem('accessToken');if(!token){window.location.href='/auth/login';return;}fetch('/api/users/me',{headers:{'Authorization':'Bearer '+token}}).then(r=>r.json()).then(data=>{if(data.data){document.getElementById('name').value=data.data.name||'';document.getElementById('email').value=data.data.email||'';document.getElementById('phone').value=data.data.phone||'';}}).catch(()=>window.location.href='/auth/login');});document.getElementById('profileForm').addEventListener('submit',async function(e){e.preventDefault();const token=localStorage.getItem('accessToken');if(!token){window.location.href='/auth/login';return;}const submitBtn=this.querySelector('button[type="submit"]');const originalContent=submitBtn.innerHTML;submitBtn.disabled=true;submitBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Saving...';const formData=new FormData(this);const data=Object.fromEntries(formData);try{const response=await fetch('/api/users/me',{method:'PUT',headers:{'Authorization':'Bearer '+token,'Content-Type':'application/json'},body:JSON.stringify(data)});const result=await response.json();if(response.ok){alert('Profile updated successfully!');location.reload();}else{alert(result.message||'Update failed');submitBtn.disabled=false;submitBtn.innerHTML=originalContent;}}catch(error){alert('An error occurred. Please try again.');submitBtn.disabled=false;submitBtn.innerHTML=originalContent;}});</script>`; %>
<%- include('../layouts/base', { title: 'Profile - Platform', body: '', scripts: scriptsContent }) %>

